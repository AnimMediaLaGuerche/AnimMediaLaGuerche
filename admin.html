<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administration - Anim'M√©dia</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: #2E8B57;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            margin-bottom: 10px;
            font-size: 2rem;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
        }

        .tab {
            flex: 1;
            padding: 15px;
            background: #e9ecef;
            border: none;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            font-weight: 600;
        }

        .tab.active {
            background: white;
            border-bottom: 3px solid #2E8B57;
            color: #2E8B57;
        }

        .tab:hover {
            background: #dee2e6;
        }

        .content {
            padding: 30px;
        }

        .form-section {
            display: none;
        }

        .form-section.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: #2E8B57;
            outline: none;
        }

        .form-group textarea {
            resize: vertical;
            height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .btn {
            background: #2E8B57;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            margin-right: 10px;
        }

        .btn:hover {
            background: #236b43;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .events-list {
            margin-top: 30px;
        }

        .event-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .event-card:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .event-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .event-title {
            font-size: 18px;
            font-weight: bold;
            color: #2E8B57;
        }

        .event-category {
            display: inline-block;
            padding: 4px 12px;
            background: #F4A460;
            color: white;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .event-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .event-info span {
            font-size: 14px;
            color: #666;
        }

        .event-actions {
            display: flex;
            gap: 10px;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .instructions {
            background: #e7f3ff;
            border: 1px solid #b8daff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .instructions h3 {
            color: #004085;
            margin-bottom: 10px;
        }

        .instructions ul {
            margin-left: 20px;
            color: #004085;
        }

        .instructions li {
            margin-bottom: 5px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .event-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .event-actions {
                flex-wrap: wrap;
            }
            
            .tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé≠ Administration Anim'M√©dia</h1>
            <p>Interface simple pour g√©rer vos √©v√©nements</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('add-event')">‚ûï Ajouter un √©v√©nement</button>
            <button class="tab" onclick="showTab('manage-events')">üìã G√©rer les √©v√©nements</button>
            <button class="tab" onclick="showTab('preview')">üëÅÔ∏è Pr√©visualisation</button>
            <button class="tab" onclick="showTab('statistics')">üìä Statistiques</button>
        </div>

        <div class="content">
            <!-- Section Ajouter un √©v√©nement -->
            <div id="add-event" class="form-section active">
                <div class="instructions">
                    <h3>üìù Instructions</h3>
                    <ul>
                        <li>Remplissez tous les champs obligatoires (*)</li>
                        <li>Les dates doivent √™tre au format JJ/MM/AAAA</li>
                        <li>Cliquez sur "Ajouter l'√©v√©nement" pour sauvegarder</li>
                        <li>L'√©v√©nement appara√Ætra automatiquement sur votre site web</li>
                    </ul>
                </div>

                <div id="alert-container"></div>

                <form id="event-form">
                    <div class="form-group">
                        <label for="title">Titre de l'√©v√©nement *</label>
                        <input type="text" id="title" name="title" required placeholder="Ex: Atelier cuisine familial">
                    </div>

                    <div class="form-group">
                        <label for="description">Description *</label>
                        <textarea id="description" name="description" required placeholder="D√©crivez votre √©v√©nement en quelques lignes..."></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="date">Date *</label>
                            <input type="date" id="date" name="date" required min="2025-01-01">
                        </div>
                        <div class="form-group">
                            <label for="time">Horaires *</label>
                            <input type="text" id="time" name="time" required placeholder="Ex: 14:00-17:00" 
                                   pattern="^([0-1]?[0-9]|2[0-3]):[0-5][0-9]-([0-1]?[0-9]|2[0-3]):[0-5][0-9]$"
                                   title="Format attendu: HH:MM-HH:MM (ex: 14:00-17:00)">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="location">Lieu *</label>
                            <input type="text" id="location" name="location" required placeholder="Ex: M√©diath√®que Jean-Paul Roussillot">
                        </div>
                        <div class="form-group">
                            <label for="category">Cat√©gorie *</label>
                            <select id="category" name="category" required>
                                <option value="">Choisir une cat√©gorie</option>
                                <option value="num√©rique">üíª Num√©rique</option>
                                <option value="cuisine">ü•û Cuisine</option>
                                <option value="spectacle">üé≠ Spectacle</option>
                                <option value="montessori">üß∏ Montessori</option>
                                <option value="√©criture">‚úçÔ∏è √âcriture</option>
                                <option value="sortie">üöå Sortie</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="price">Tarif</label>
                            <input type="text" id="price" name="price" placeholder="Ex: Gratuit, 5‚Ç¨, Prix libre" value="Gratuit">
                        </div>
                        <div class="form-group">
                            <label for="max_participants">Nombre de places</label>
                            <input type="number" id="max_participants" name="max_participants" placeholder="Ex: 20" min="1">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="age_group">Public cible</label>
                            <select id="age_group" name="age_group">
                                <option value="Tous √¢ges">Tous √¢ges</option>
                                <option value="Enfants">Enfants</option>
                                <option value="Adultes">Adultes</option>
                                <option value="Seniors">Seniors</option>
                                <option value="Familles">Familles</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="contact">Contact</label>
                            <input type="email" id="contact" name="contact" placeholder="Ex: contact@anim-media.fr">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="registration_required" name="registration_required">
                            Inscription obligatoire
                        </label>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="recurring" name="recurring">
                            √âv√©nement r√©current (chaque semaine)
                        </label>
                    </div>

                    <div class="form-group">
                        <label for="notes">Notes suppl√©mentaires</label>
                        <textarea id="notes" name="notes" placeholder="Informations compl√©mentaires..."></textarea>
                    </div>

                    <button type="submit" class="btn">‚úÖ Ajouter l'√©v√©nement</button>
                    <button type="button" class="btn btn-secondary" onclick="previewEvent()">üëÅÔ∏è Pr√©visualiser</button>
                    <button type="reset" class="btn btn-secondary">üîÑ Effacer le formulaire</button>
                    <button type="button" class="btn btn-secondary" onclick="saveDraft()">üíæ Sauvegarder en brouillon</button>
                </form>
            </div>

            <!-- Section G√©rer les √©v√©nements -->
            <div id="manage-events" class="form-section">
                <div class="instructions">
                    <h3>üìã Gestion des √©v√©nements</h3>
                    <ul>
                        <li>Consultez tous vos √©v√©nements existants</li>
                        <li>Modifiez ou supprimez les √©v√©nements</li>
                        <li>Les changements sont appliqu√©s imm√©diatement</li>
                    </ul>
                </div>

                <div id="events-alert-container"></div>
                
                <div class="events-list">
                    <div id="events-loading" class="loading">
                        <p>üîÑ Chargement des √©v√©nements...</p>
                    </div>
                    <div id="events-container"></div>
                </div>
            </div>

            <!-- Section Pr√©visualisation -->
            <div id="preview" class="form-section">
                <div class="instructions">
                    <h3>üëÅÔ∏è Pr√©visualisation</h3>
                    <ul>
                        <li>Visualisez comment vos √©v√©nements appara√Ætront sur le site</li>
                        <li>Testez l'affichage mobile et desktop</li>
                        <li>V√©rifiez le formatage avant publication</li>
                    </ul>
                </div>
                
                <div style="display: flex; gap: 1rem; margin-bottom: 2rem;">
                    <button class="btn" onclick="setPreviewMode('desktop')">üñ•Ô∏è Vue Desktop</button>
                    <button class="btn btn-secondary" onclick="setPreviewMode('mobile')">üì± Vue Mobile</button>
                </div>
                
                <div id="preview-container" style="border: 1px solid #ddd; border-radius: 8px; padding: 20px; background: #f9f9f9;">
                    <p style="text-align: center; color: #666;">Utilisez le bouton "Pr√©visualiser" dans le formulaire pour voir l'aper√ßu d'un √©v√©nement</p>
                </div>
            </div>

            <!-- Section Statistiques -->
            <div id="statistics" class="form-section">
                <div class="instructions">
                    <h3>üìä Statistiques</h3>
                    <ul>
                        <li>Aper√ßu de vos activit√©s et √©v√©nements</li>
                        <li>R√©partition par cat√©gories</li>
                        <li>√âv√©nements √† venir et pass√©s</li>
                    </ul>
                </div>
                
                <div id="stats-container">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div class="stat-card">
                            <h4>üìÖ Total √©v√©nements</h4>
                            <div class="stat-number" id="total-events">0</div>
                        </div>
                        <div class="stat-card">
                            <h4>üîú √Ä venir</h4>
                            <div class="stat-number" id="upcoming-events">0</div>
                        </div>
                        <div class="stat-card">
                            <h4>‚úÖ Pass√©s</h4>
                            <div class="stat-number" id="past-events">0</div>
                        </div>
                        <div class="stat-card">
                            <h4>üéØ Cat√©gorie populaire</h4>
                            <div class="stat-number" id="popular-category">-</div>
                        </div>
                    </div>
                    
                    <div id="category-breakdown"></div>
                </div>
            </div>
        </div>
    </div>

    <style>
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-card h4 {
            margin-bottom: 10px;
            color: #666;
            font-size: 14px;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #2E8B57;
        }
        
        .preview-mobile {
            max-width: 375px;
            margin: 0 auto;
        }
        
        .draft-indicator {
            display: inline-block;
            background: #ffc107;
            color: #212529;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
    </style>

    <script>
        // Variables globales
        let events = [];
        let editingEventId = null;
        let currentPreviewMode = 'desktop';

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            loadEvents();
            loadDrafts();
            updateStatistics();
        });

        // Gestion des onglets
        function showTab(tabName) {
            // Masquer toutes les sections
            document.querySelectorAll('.form-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // D√©sactiver tous les onglets
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Activer la section et l'onglet correspondants
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // Recharger les √©v√©nements si on va sur l'onglet de gestion
            if (tabName === 'manage-events') {
                loadEvents();
            } else if (tabName === 'statistics') {
                updateStatistics();
            }
        }

        // Pr√©visualisation d'√©v√©nement
        function previewEvent() {
            const formData = new FormData(document.getElementById('event-form'));
            const eventData = {
                title: formData.get('title') || 'Titre de l\'√©v√©nement',
                description: formData.get('description') || 'Description de l\'√©v√©nement',
                date: formData.get('date') || '2025-12-31',
                time: formData.get('time') || '10:00-12:00',
                location: formData.get('location') || 'Lieu de l\'√©v√©nement',
                category: formData.get('category') || 'num√©rique',
                price: formData.get('price') || 'Gratuit',
                registration_required: formData.has('registration_required'),
                max_participants: parseInt(formData.get('max_participants')) || null,
                age_group: formData.get('age_group') || 'Tous √¢ges'
            };

            const previewHTML = generateEventPreview(eventData);
            document.getElementById('preview-container').innerHTML = previewHTML;
            
            // Changer vers l'onglet pr√©visualisation
            showTab('preview');
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab')[2].classList.add('active');
            
            showAlert('üëÅÔ∏è Pr√©visualisation g√©n√©r√©e ! Consultez l\'onglet Pr√©visualisation.', 'success');
        }

        // G√©n√©rer l'HTML de pr√©visualisation
        function generateEventPreview(eventData) {
            const containerClass = currentPreviewMode === 'mobile' ? 'preview-mobile' : '';
            return `
                <div class="${containerClass}">
                    <div class="event-card" style="max-width: none;">
                        <div class="event-header">
                            <div class="event-title">${eventData.title}</div>
                            <div class="event-category">${getCategoryIcon(eventData.category)} ${eventData.category}</div>
                        </div>
                        <div class="event-info">
                            <span><strong>üìÖ Date:</strong> ${formatDate(eventData.date)}</span>
                            <span><strong>üïê Horaire:</strong> ${eventData.time}</span>
                            <span><strong>üìç Lieu:</strong> ${eventData.location}</span>
                            <span><strong>üí∞ Tarif:</strong> ${eventData.price}</span>
                            <span><strong>üë• Places:</strong> ${eventData.max_participants || 'Illimit√©es'}</span>
                            <span><strong>üéØ Public:</strong> ${eventData.age_group}</span>
                        </div>
                        <p><strong>Description:</strong> ${eventData.description}</p>
                        <div class="event-actions">
                            <button class="btn" disabled>‚úèÔ∏è Modifier</button>
                            <button class="btn btn-danger" disabled>üóëÔ∏è Supprimer</button>
                        </div>
                        <p style="margin-top: 10px; font-style: italic; color: #666; text-align: center;">
                            üìã Ceci est un aper√ßu - les boutons ne sont pas fonctionnels
                        </p>
                    </div>
                </div>
            `;
        }

        // Changer le mode de pr√©visualisation
        function setPreviewMode(mode) {
            currentPreviewMode = mode;
            const container = document.getElementById('preview-container');
            if (container.innerHTML.includes('event-card')) {
                // Reg√©n√©rer la pr√©visualisation avec le nouveau mode
                const eventCard = container.querySelector('.event-card');
                if (eventCard) {
                    container.innerHTML = container.innerHTML.replace('preview-mobile', '');
                    if (mode === 'mobile') {
                        container.innerHTML = container.innerHTML.replace('<div class="">', '<div class="preview-mobile">');
                    }
                }
            }
        }

        // Gestion des brouillons
        function saveDraft() {
            const formData = new FormData(document.getElementById('event-form'));
            const draftData = {
                title: formData.get('title'),
                description: formData.get('description'),
                date: formData.get('date'),
                time: formData.get('time'),
                location: formData.get('location'),
                category: formData.get('category'),
                price: formData.get('price'),
                registration_required: formData.has('registration_required'),
                max_participants: formData.get('max_participants'),
                age_group: formData.get('age_group'),
                contact: formData.get('contact'),
                notes: formData.get('notes'),
                saved_at: new Date().toISOString()
            };

            const drafts = JSON.parse(localStorage.getItem('event_drafts') || '[]');
            const draftId = 'draft_' + Date.now();
            drafts.push({...draftData, id: draftId});
            localStorage.setItem('event_drafts', JSON.stringify(drafts));
            
            showAlert('üíæ Brouillon sauvegard√© ! Vous pouvez le retrouver m√™me apr√®s fermeture du navigateur.', 'success');
            loadDrafts();
        }

        // Charger les brouillons
        function loadDrafts() {
            const drafts = JSON.parse(localStorage.getItem('event_drafts') || '[]');
            if (drafts.length > 0) {
                const draftSelect = document.createElement('select');
                draftSelect.innerHTML = '<option value="">Charger un brouillon</option>' + 
                    drafts.map(draft => `<option value="${draft.id}">${draft.title || 'Brouillon sans titre'} (${new Date(draft.saved_at).toLocaleDateString()})</option>`).join('');
                draftSelect.style.cssText = 'margin-bottom: 20px; padding: 10px; border-radius: 5px; border: 1px solid #ddd;';
                draftSelect.addEventListener('change', function() {
                    if (this.value) loadDraft(this.value);
                });
                
                const form = document.getElementById('event-form');
                if (!document.getElementById('draft-selector')) {
                    draftSelect.id = 'draft-selector';
                    form.parentNode.insertBefore(draftSelect, form);
                }
            }
        }

        // Charger un brouillon sp√©cifique
        function loadDraft(draftId) {
            const drafts = JSON.parse(localStorage.getItem('event_drafts') || '[]');
            const draft = drafts.find(d => d.id === draftId);
            if (!draft) return;

            // Remplir le formulaire avec les donn√©es du brouillon
            Object.keys(draft).forEach(key => {
                const field = document.getElementById(key);
                if (field) {
                    if (field.type === 'checkbox') {
                        field.checked = draft[key];
                    } else {
                        field.value = draft[key] || '';
                    }
                }
            });

            showAlert('üìã Brouillon charg√© ! Vous pouvez continuer √† l\'√©diter.', 'success');
        }

        // Mise √† jour des statistiques
        function updateStatistics() {
            if (events.length === 0) return;

            const now = new Date();
            const upcomingEvents = events.filter(e => new Date(e.date) >= now);
            const pastEvents = events.filter(e => new Date(e.date) < now);

            // Compter par cat√©gories
            const categoryCount = {};
            events.forEach(e => {
                categoryCount[e.category] = (categoryCount[e.category] || 0) + 1;
            });

            const popularCategory = Object.keys(categoryCount).reduce((a, b) => 
                categoryCount[a] > categoryCount[b] ? a : b, Object.keys(categoryCount)[0] || '-'
            );

            // Mettre √† jour l'affichage
            document.getElementById('total-events').textContent = events.length;
            document.getElementById('upcoming-events').textContent = upcomingEvents.length;
            document.getElementById('past-events').textContent = pastEvents.length;
            document.getElementById('popular-category').textContent = popularCategory !== undefined ? 
                `${getCategoryIcon(popularCategory)} ${popularCategory}` : '-';

            // Graphique des cat√©gories
            const categoryBreakdown = Object.entries(categoryCount)
                .map(([cat, count]) => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; margin: 5px 0; background: white; border-radius: 5px;">
                        <span>${getCategoryIcon(cat)} ${cat}</span>
                        <span style="font-weight: bold; color: #2E8B57;">${count}</span>
                    </div>
                `).join('');

            document.getElementById('category-breakdown').innerHTML = `
                <h4 style="margin-bottom: 15px;">R√©partition par cat√©gories</h4>
                ${categoryBreakdown}
            `;
        }

        // Chargement des √©v√©nements
        async function loadEvents() {
            try {
                const response = await fetch('data/events.json');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                const data = await response.json();
                events = data.events || [];
                displayEvents();
                showAlert(`‚úÖ ${events.length} √©v√©nement(s) charg√©(s) avec succ√®s`, 'success', 'events-alert-container');
            } catch (error) {
                console.error('Erreur lors du chargement:', error);
                // Simuler des donn√©es exemple si le fichier n'existe pas
                events = getSampleEvents();
                displayEvents();
                showAlert('‚ö†Ô∏è Fichier events.json non trouv√©. Donn√©es d\'exemple charg√©es.', 'error', 'events-alert-container');
                document.getElementById('events-loading').style.display = 'none';
            }
        }

        // Donn√©es d'exemple si le fichier n'existe pas
        function getSampleEvents() {
            return [
                {
                    id: 1,
                    title: "Caf√© num√©rique",
                    description: "Accompagnement personnalis√© pour vos d√©marches num√©riques",
                    date: "2025-09-04",
                    time: "10:00-12:00",
                    location: "M√©diath√®que Jean-Paul Roussillot",
                    category: "num√©rique",
                    price: "Gratuit",
                    registration_required: false,
                    max_participants: 12,
                    age_group: "Tous √¢ges",
                    contact: "cafe.numerique@anim-media.fr"
                }
            ];
        }

        // Affichage des √©v√©nements
        function displayEvents() {
            const container = document.getElementById('events-container');
            const loading = document.getElementById('events-loading');
            
            loading.style.display = 'none';

            if (events.length === 0) {
                container.innerHTML = '<p class="loading">Aucun √©v√©nement trouv√©. Ajoutez votre premier √©v√©nement !</p>';
                return;
            }

            // Trier les √©v√©nements par date
            const sortedEvents = events.sort((a, b) => new Date(a.date) - new Date(b.date));

            container.innerHTML = sortedEvents.map(event => `
                <div class="event-card">
                    <div class="event-header">
                        <div class="event-title">${event.title}</div>
                        <div class="event-category">${getCategoryIcon(event.category)} ${event.category}</div>
                    </div>
                    <div class="event-info">
                        <span><strong>üìÖ Date:</strong> ${formatDate(event.date)}</span>
                        <span><strong>üïê Horaire:</strong> ${event.time}</span>
                        <span><strong>üìç Lieu:</strong> ${event.location}</span>
                        <span><strong>üí∞ Tarif:</strong> ${event.price}</span>
                        <span><strong>üë• Places:</strong> ${event.max_participants || 'Illimit√©es'}</span>
                        <span><strong>üéØ Public:</strong> ${event.age_group}</span>
                    </div>
                    <p><strong>Description:</strong> ${event.description}</p>
                    <div class="event-actions">
                        <button class="btn" onclick="editEvent(${event.id})">‚úèÔ∏è Modifier</button>
                        <button class="btn btn-danger" onclick="deleteEvent(${event.id})">üóëÔ∏è Supprimer</button>
                    </div>
                </div>
            `).join('');
        }

        // Formatage de la date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('fr-FR', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        // Ic√¥nes des cat√©gories
        function getCategoryIcon(category) {
            const icons = {
                'num√©rique': 'üíª',
                'cuisine': 'ü•û',
                'spectacle': 'üé≠',
                'montessori': 'üß∏',
                '√©criture': '‚úçÔ∏è',
                'sortie': 'üöå'
            };
            return icons[category] || 'üìÖ';
        }

        // Gestion du formulaire
        document.getElementById('event-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const eventData = {
                id: editingEventId || Date.now(),
                title: formData.get('title'),
                description: formData.get('description'),
                date: formData.get('date'),
                time: formData.get('time'),
                location: formData.get('location'),
                category: formData.get('category'),
                price: formData.get('price') || 'Gratuit',
                registration_required: formData.has('registration_required'),
                recurring: formData.has('recurring'),
                max_participants: parseInt(formData.get('max_participants')) || null,
                current_participants: 0,
                age_group: formData.get('age_group') || 'Tous √¢ges',
                contact: formData.get('contact') || 'contact@anim-media.fr',
                notes: formData.get('notes') || undefined
            };

            // Nettoyer les champs vides
            Object.keys(eventData).forEach(key => {
                if (eventData[key] === '' || eventData[key] === undefined) {
                    delete eventData[key];
                }
            });

            if (editingEventId) {
                updateEvent(eventData);
            } else {
                addEvent(eventData);
            }
        });

        // Ajouter un √©v√©nement
        function addEvent(eventData) {
            events.push(eventData);
            saveEvents();
            showAlert('‚úÖ √âv√©nement ajout√© avec succ√®s !', 'success');
            document.getElementById('event-form').reset();
        }

        // Modifier un √©v√©nement
        function editEvent(id) {
            const event = events.find(e => e.id === id);
            if (!event) return;

            // Remplir le formulaire avec les donn√©es de l'√©v√©nement
            document.getElementById('title').value = event.title;
            document.getElementById('description').value = event.description;
            document.getElementById('date').value = event.date;
            document.getElementById('time').value = event.time;
            document.getElementById('location').value = event.location;
            document.getElementById('category').value = event.category;
            document.getElementById('price').value = event.price || '';
            document.getElementById('max_participants').value = event.max_participants || '';
            document.getElementById('age_group').value = event.age_group || 'Tous √¢ges';
            document.getElementById('contact').value = event.contact || '';
            document.getElementById('registration_required').checked = event.registration_required || false;
            document.getElementById('recurring').checked = event.recurring || false;
            document.getElementById('notes').value = event.notes || '';

            editingEventId = id;
            
            // Changer l'onglet vers le formulaire d'ajout
            showTab('add-event');
            document.querySelector('.tab').classList.remove('active');
            document.querySelector('.tab').classList.add('active');
            
            // Faire d√©filer vers le haut
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            showAlert('üìù Modification en cours. Modifiez les champs et cliquez sur "Ajouter l\'√©v√©nement"', 'success');
        }

        // Mettre √† jour un √©v√©nement
        function updateEvent(eventData) {
            const index = events.findIndex(e => e.id === editingEventId);
            if (index !== -1) {
                events[index] = eventData;
                saveEvents();
                showAlert('‚úÖ √âv√©nement modifi√© avec succ√®s !', 'success');
                document.getElementById('event-form').reset();
                editingEventId = null;
            }
        }

        // Supprimer un √©v√©nement
        function deleteEvent(id) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer cet √©v√©nement ?')) {
                events = events.filter(e => e.id !== id);
                saveEvents();
                displayEvents();
                showAlert('üóëÔ∏è √âv√©nement supprim√© avec succ√®s !', 'success', 'events-alert-container');
            }
        }

        // Sauvegarder les √©v√©nements
        function saveEvents() {
            const jsonData = {
                events: events,
                last_updated: new Date().toISOString(),
                generated_by: "Interface d'administration Anim'M√©dia",
                version: "1.0"
            };
            
            // Validation des donn√©es avant sauvegarde
            const validEvents = events.filter(event => {
                return event.title && event.date && event.category;
            });
            
            if (validEvents.length !== events.length) {
                showAlert('‚ö†Ô∏è Certains √©v√©nements ont des donn√©es incompl√®tes et ont √©t√© exclus', 'error');
                jsonData.events = validEvents;
            }
            
            // Cr√©er un blob et d√©clencher le t√©l√©chargement
            const blob = new Blob([JSON.stringify(jsonData, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `events_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showAlert(`üíæ Fichier events.json t√©l√©charg√© avec ${validEvents.length} √©v√©nement(s) ! Remplacez-le dans votre dossier "data/" pour mettre √† jour le site.`, 'success');
            
            // Proposer l'ouverture directe du dossier data
            setTimeout(() => {
                if (confirm('Voulez-vous des instructions pour remplacer le fichier ?')) {
                    showReplacementInstructions();
                }
            }, 1000);
        }

        // Instructions de remplacement
        function showReplacementInstructions() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); z-index: 10000; display: flex;
                align-items: center; justify-content: center;
            `;
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; max-width: 500px; margin: 20px;">
                    <h3 style="color: #2E8B57; margin-bottom: 20px;">üìã Instructions de mise √† jour</h3>
                    <ol style="line-height: 1.8; margin-bottom: 20px;">
                        <li>Ouvrez votre dossier de projet</li>
                        <li>Allez dans le dossier <code>data/</code></li>
                        <li>Remplacez l'ancien <code>events.json</code> par le nouveau fichier t√©l√©charg√©</li>
                        <li>Rechargez votre site web pour voir les changements</li>
                    </ol>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="background: #2E8B57; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">
                        Compris !
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Afficher les alertes
        function showAlert(message, type = 'success', containerId = 'alert-container') {
            const container = document.getElementById(containerId);
            const alertClass = type === 'error' ? 'alert-error' : 'alert-success';
            
            container.innerHTML = `
                <div class="alert ${alertClass}">
                    ${message}
                </div>
            `;
            
            // Masquer l'alerte apr√®s 5 secondes
            setTimeout(() => {
                container.innerHTML = '';
            }, 5000);
        }
    </script>
</body>
</html>
